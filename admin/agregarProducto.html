<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agregar producto</title>
    <script src="/public/js/cargarReutilizable.js"></script>
    <link rel="stylesheet" href="/public/css/comun.css">
    <link rel="stylesheet" href="/public/css/agregrarProducto.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> 
</head>
<body>
   <div id="header"></div>
    <div class="container">
        <h1>Agregar Producto</h1>
<form  enctype="multipart/form-data">
    <label for="nombre">Nombre del Producto</label>
    <input type="text" id="nombre" name="nombre" placeholder="Lenovo ThinkPad X220 Tablet " required>

    <label for="descripcion">Descripción</label>
    <textarea maxlength="660" id="descripcion" name="descripcion" placeholder="Maximo 660 caracteres" required></textarea>
    <span id="descripcion-contador">0/660</span>

    <label for="procesador">Procesador</label>
    <input type="text" id="procesador" name="procesador" placeholder="i7-2620M, i5-1135G7" required>

    <label for="ram">RAM</label>
    <select id="ram" name="ram" required>
        <option value="4GB">4GB</option>
        <option value="8GB">8GB</option>
        <option value="16GB">16GB</option>
        <option value="32GB">32GB</option>
        <option value="64GB">64GB</option>
    </select>

    <label for="rom">Almacenamiento</label>
    <select id="rom" name="rom" required>
        <option value="128GB">128GB</option>
        <option value="180GB">180GB</option>
        <option value="256GB">256GB</option>
        <option value="512GB">512GB</option>
        <option value="1TB">1TB</option>
        <option value="2TB">2TB</option>
        <option value="4TB">4TB</option>
    </select>

    <label for="tipo_almacenamiento">Tipo de Almacenamiento</label>
    <select id="tipo_almacenamiento" name="tipo_almacenamiento" required>
        <option value="SSD">SSD</option>
        <option value="HDD">HDD</option>
    </select>

    <label for="precio">Precio</label>
    <input type="number" id="precio" name="precio" required>

    <label for="stock">Stock</label>
    <input type="number" id="stock" name="stock" required>

    <label for="tamano_pantalla">Tamaño de Pantalla</label>
    <select id="tamano_pantalla" name="tamano_pantalla" required>
        <option value="12.5">12.5"</option>
        <option value="14">14"</option>
        <option value="15.6">15.6"</option>
        <option value="17.3">17.3"</option>
    </select>

    <label for="resolucion_pantalla">Resolución de Pantalla</label>
    <select id="resolucion_pantalla" name="resolucion_pantalla" required>
        <option value="1080x1920">1080x1920 (FHD)</option>
        <option value="1366x768">1366x768 (HD)</option>
        <option value="2560x1440">2560x1440 (QHD)</option>
        <option value="3840x2160">3840x2160 (4K)</option>
    </select>


    <label for="sistema_operativo">Sistema Operativo</label>
    <select id="sistema_operativo" name="sistema_operativo" required>
        <option value="W11">Windows 11 Pro</option>
        <option value="W10">Windows 10 Pro</option>
        <option value="Ubuntu">Ubuntu</option>
        <option value="Fedora">Fedora</option>
        <option value="Debian">Debian</option>
    </select>

    <label for="tarjeta_grafica">Tarjeta Gráfica</label>
    <input type="text" id="tarjeta_grafica" name="tarjeta_grafica" placeholder="Nvidia MX150, Nvidia GTX 1650" required>

    <label for="peso">Peso</label> 
    <input type="number" step="0.01" id="peso" name="peso"  placeholder="En kg" required>

    <label for="dimensiones">Dimensiones</label>
    <input type="text" id="dimensiones" name="dimensiones" placeholder="32.4 x 22.5 x 1.8 cm" required>

    <label for="garantia_meses">Garantía (Meses)</label>
    <select id="garantia_meses" name="garantia_meses" required>
        <option value="6">6 meses</option>
        <option value="12">12 meses</option>
        <option value="18">18 meses</option>
        <option value="24">24 meses</option>
        <option value="36">36 meses</option>

    </select>

    <label for="categoria">Categoría</label>
    <select id="categoria" name="categoria" required>
        <option value="oficina">Oficina</option>
        <option value="gamer">Gamer</option>
        <option value="trabajo">Trabajo</option>
        <option value="estudio">Estudio</option>
    </select>

    <label for="marca">Marca</label>
    <select id="marca" name="marca" required>
        <option value="Lenovo">Lenovo</option>
        <option value="Asus">Asus</option>
        <option value="HP">HP</option>
        <option value="Toshiba">Toshiba</option>
        <option value="Dell">Dell</option>
        <option value="Acer">Acer</option>
        <option value="Apple">Apple</option>
        <option value="Microsoft">Microsoft</option>
        <option value="Razer">Razer</option>
        <option value="Samsung">Samsung</option>
        <option value="MSI">MSI</option>
        <option value="Gigabyte">Gigabyte</option>
        <option value="Alienware">Alienware</option>
        <option value="Huawei">Huawei</option>
        <option value="LG">LG</option>
        <option value="Vaio">Vaio</option>
        <option value="Google">Google</option>
    </select>
    

    <label for="fecha_lanzamiento">Fecha de Lanzamiento</label>
    <input type="date" id="fecha_lanzamiento" name="fecha_lanzamiento" required>

    <label for="imagenes_url">URLs de Imágenes (separadas por comas)</label>
    <textarea id="imagenes_url" name="imagenes_url" required placeholder="https://example.com/image1.jpg, https://example.com/image2.jpg"></textarea>

    <button type="submit">Agregar Producto</button>
</form>

    </div>
    <div id="footer"></div>    
    <script>
        const descripcion = document.getElementById('descripcion');
        const contador = document.getElementById('descripcion-contador');
    
        descripcion.addEventListener('input', () => {
            contador.textContent = `${descripcion.value.length}/660`;
        });
    </script>

    <script>
        const form = document.querySelector('form');
    
        form.addEventListener('submit', (e) => {
            e.preventDefault(); // Evitar el envío por defecto del formulario
            const formData = new FormData(form);
    
            // Validar URL de las imágenes
            const imagenesUrl = formData.get('imagenes_url');
            const urls = imagenesUrl.split(',').map(url => url.trim());
            const urlRegex = /^(https?:\/\/)[^\s$.?#].[^\s]*$/;
    
            if (!urls.every(url => urlRegex.test(url))) {
                Swal.fire({
                    title: 'Error',
                    text: 'Asegúrate de ingresar URLs válidas.',
                    icon: 'error',
                    confirmButtonText: 'Cerrar'
                });
                return;
            }
    
            // Enviar el formulario al servidor
            fetch('/add-product', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(Object.fromEntries(formData))
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        Swal.fire({
                            title: '¡Éxito!',
                            text: 'Producto agregado correctamente.',
                            icon: 'success',
                            confirmButtonText: 'Ir al Dashboard'
                        }).then(() => {
                            window.location.href = '/admin/dashboard.html'; 
                        });
                    } else {
                        Swal.fire({
                            title: 'Error',
                            text: data.message || 'Hubo un problema al agregar el producto.',
                            icon: 'error',
                            confirmButtonText: 'Cerrar'
                        });
                    }
                })
                .catch(() => {
                    Swal.fire({
                        title: 'Error',
                        text: 'No se pudo conectar con el servidor.',
                        icon: 'error',
                        confirmButtonText: 'Cerrar'
                    });
                });
        });
    </script>

</body>
</html>